// Nicholas Johnson (www.nicholasjohnson.com)
// Forward Advance Training (www.forwardadvance.com)
// MIT licence

!function(){var e=angular.element(['<div class="widget-placeholder">',"</div>"].join("")),t={size:10,check:function(e){var o,r,i,a;for(r=document.querySelectorAll("[draggable-widget]"),o=0;o<r.length;o++)i=r[o],a=i.getBoundingClientRect(),t.checkBefore(a,e.pageX,e.pageY)?n.insertBefore(i):t.checkAfter(a,e.pageX,e.pageY)&&n.insertAfter(i)},checkBefore:function(e,n,o){return o>e.top&&o<e.bottom&&n>e.left-t.size&&n<e.left+t.size},checkAfter:function(e,n,o){return o>e.top&&o<e.bottom&&n>e.right-t.size&&n<e.right+t.size}},n={show:function(t){e[0].hidden=!1,e.css({width:t[0].clientWidth+"px",height:t[0].clientHeight+"px"}),t.after(e)},hide:function(){e[0].hidden=!0},insertAfter:function(t){angular.element(t).after(e)},insertBefore:function(t){angular.element(t).parent()[0].insertBefore(t,e[0])}},o=function(e){var t=e.drag={};t.start=function(e){console.log("start drag"),t.initDrag(e)},t.end=function(e){t.destroyDrag()}};o.$inject=["$scope"];var r=function(e,o,r){var i=function(t){o.css({left:t.pageX-e.drag.offsetX-20+"px",top:t.pageY-e.drag.offsetY-20+"px"})};e.drag.initDrag=function(r){console.log("start drag"),e.drag.offsetX=r.offsetX,e.drag.offsetY=r.offsetY,i(r),o.addClass("dragging"),o.css({position:"absolute","z-index":1e5}),n.show(o),angular.element(window).on("mousemove",function(e){i(e),t.check(e)})},e.drag.destroyDrag=function(){console.log("stop drag"),o.removeClass("dragging"),angular.element(window).off("mousemove"),o.css({position:"",left:"",top:"","z-index":""}),n.hide()}},i=function(e,t,n){t.on("mousedown",function(t){e.drag.initDrag(t)}),t.on("mouseup",function(t){e.drag.destroyDrag(t)})};angular.module("ng-draggable-widgets",[]).directive("draggableWidget",function(){return{scope:!0,restrict:"A",controller:o,link:{pre:r}}}).directive("draggableWidgetHandle",function(){return{scope:!0,restrict:"A",link:{pre:i}}})}();